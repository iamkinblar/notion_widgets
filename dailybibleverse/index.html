<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible verse widget</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    // getting a random biblical verse
        (function() {
            $(document ).ready(function() {
                getVerse();
            });
          
            $(".refreshbtn").click(function(){
              getVerse();
            });
          
            var getVerse = function() {
                $.ajax({
                  url: "https://labs.bible.org/api/?passage=random&type=json&callback=myCallback", 
                  crossDomain: true,
                  dataType: 'jsonp',
                  success: function(result){
                     $(".verse-text")
                       .html(result[0].text);
                     $(".verse-reference")
                        .html(result[0].bookname + ' ' + result[0].chapter +':' + result[0].verse)
                  }
                });
            }
          })();

          // to skip the verses are that are too long
  function skipVerse() {
    const maxSentences = 3; // Maximum number of sentences allowed (adjust as needed)
    const maxWords = 20; // Maximum number of words allowed (adjust as needed)
  
    $.ajax({
      url: "https://labs.bible.org/api/?passage=random&type=json&callback=myCallback",
      crossDomain: true,
      dataType: 'jsonp',
      success: function(result) {
        const verseText = result[0].text;
  
        if (countSentences(verseText) > maxSentences || countWords(verseText) > maxWords) {
          // Verse has too many sentences or words, skip it and fetch another verse
          getVerse();
        } else {
          $(".verse-text").html(verseText);
          adjustFontSize();
          adjustMaxHeight();
        }
      },
      error: function(xhr, status, error) {
        console.error('An error occurred:', error);
      }
    });
  }
  
  function countSentences(text) {
    // Split the text by sentence-ending punctuation marks to count sentences
    const sentences = text.split(/[.!?]+/); // Split by one or more sentence-ending punctuation marks
    return sentences.length;
  }
  
  function countWords(text) {
    // Remove leading/trailing spaces and split the text by spaces to count words
    const trimmedText = text.trim();
    const words = trimmedText.split(/\s+/); // Split by one or more whitespace characters
    return words.length;
  }
  
  
  
// to adjust the font size
  function adjustFontSize() {
    const versetextElement = document.getElementsByClassName("verse-text")[0];
    const containerWidth = versetextElement.offsetWidth;
    const containerHeight = versetextElement.offsetHeight;
  
    const text = versetextElement.innerText;
  
    let fontSize = 20; // Starting font size (adjust as needed)
    versetextElement.style.fontSize = fontSize + "px";
  
    while (
      (versetextElement.offsetWidth > containerWidth || versetextElement.offsetHeight > containerHeight) &&
      fontSize > 12 // Minimum font size (adjust as needed)
    ) {
      fontSize--;
      versetextElement.style.fontSize = fontSize + "px";
    }
  }  
  
  function measureTextWidth(text, fontSize) {
    const canvas = document.createElement("canvas");
    const context = canvas.getContext("2d");
    context.font = fontSize + "px 'CopperplateGothicBRFont', sans-serif";
    return context.measureText(text).width;
  }
  
  function measureTextHeight(text, fontSize) {
    const span = document.createElement("span");
    span.style.fontSize = fontSize + "px";
    span.style.fontFamily = "'CopperplateGothicBRFont', sans-serif";
    span.innerText = text;
    document.body.appendChild(span);
    const height = span.offsetHeight;
    document.body.removeChild(span);
    return height;
  }
  
  // Call adjustFontSize on window resize
  window.addEventListener("resize", adjustFontSize);
  
  // Call adjustFontSize after the verse text is updated
  function adjustVerse() {
    $.ajax({
      url: "https://labs.bible.org/api/?passage=random&type=json&callback=myCallback",
      crossDomain: true,
      dataType: 'jsonp',
      success: function(result) {
        $(".verse-text").html(result[0].text);
        adjustFontSize();
      },
      error: function(xhr, status, error) {
        console.error('An error occurred:', error);
      }
    });
  }
  
  $(document).ready(function() {
    adjustVerse();
  
    $(".refreshbtn").click(function() {
      adjustVerse();
    });
  });
    </script>    
</head>
<body>
    <div class="widget">
        <img src="homepage 5 (2).png" id="center">
        <p class="title">Bible verse of the day</p>
        <p class="verse-text neon">Loading...</p>
        <span class="verse-reference">Loading...</span>
        <button class="refreshbtn outline">R</button> 
    </div>
</body>
</html>



